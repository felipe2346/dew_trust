{% extends './base.html' %}
{% load static %}

{% block content %}
<style>
    .btn-warning{
        background-color: #ff7a00;
        border-color: #ff7a00;
    }
    .btn-primary{
        background-color: #182978 !important;
        border-color: #182978 !important;
    }
    .btn:focus{
        border-color: #131c44 !important;
        box-shadow: none !important;
    }
    .form-section {
      display: none;
    }
    .form-section.active {
      display: block;
    }
    .form-navigation {
      margin-top: 20px;
    }
</style>
<!--Start breadcrumb Style1-->
<section class="breadcrumb-style1">
    <div class="shape-bottom"></div>
    <div class="breadcrumb-style1-bg" style="background-image: url(/static/frontend2/images/breadcrumb-1.jpg);">
    </div>
    <div class="breadcrumb-style1__border-line-left"></div>
    <div class="breadcrumb-style1__border-line-right"></div>
    <div class="container">
        <div class="row">
            <div class="col-xl-12">
                <div class="inner-content">
                    <div class="title">
                        <h2>Apply</h2>
                    </div>
                    <div class="breadcrumb-menu">
                        <ul class="clearfix">
                            <li><a href="/">Home</a></li>
                            <li class="active">Loan</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!--End breadcrumb Style1-->

<div class="container py-5">
    <div class="row justify-content-center align-items-center">
        <div class="col-md-6">
            <div class="card shadow">
                {% include '../regulars/alert.html' %}
                <div class="card-body">
                    <h4 class="text-center">Apply For Loan</h4>
                    
                    <hr style="border-color: black;">

                    <form action="." method="post" id="my_loan_form">
                        {% csrf_token %}
                        <!-- section 1 -->
                        <div class="form-section active" data-step="1">
                            <div class="mb-3">
                                <label for="full_name" class="form-label fw-bold">Full Name</label>
                                <input type="text" name="full_name" class="form-control" id="full_name">
                            </div>
                            <div class="mb-3">
                                <label for="email" class="form-label fw-bold">Email</label>
                                <input type="email" name="email" class="form-control" id="email">
                            </div>
                            <div class="mb-3">
                                <label for="phone_number" class="form-label fw-bold">Phone Number</label>
                                <input type="text" name="phone_number" class="form-control" id="phone_number">
                            </div>
                        </div>

                        <!-- Section 2 -->
                        <div class="form-section" data-step="2">
                            <div class="mb-3">
                                <label for="address" class="form-label fw-bold">Address</label>
                                <input type="text" name="address" class="form-control" id="address">
                            </div>
                            <div class="mb-3">
                                <label for="state" class="form-label fw-bold">State</label>
                                <input type="text" name="state" class="form-control" id="state">
                            </div>
                            <div class="mb-3">
                                <label for="country" class="form-label fw-bold">Country</label>
                                <input type="text" name="country" class="form-control" id="country">
                            </div>
                        </div>

                        <!-- Section 3 -->
                        <div class="form-section" data-step="3">
                            <div class="mb-3 mt-3">
                                <label for="occupation" class="form-label fw-bold">Occupation</label>
                                <input type="text" name="occupation" class="form-control" id="occupation" required>
                            </div>
                            <div class="mb-3">
                                <label for="loan_type" class="form-label fw-bold">Loan Type</label>
                                <select class="form-select mb-3 w-100" id="loan_type">
                                    <!-- <option selected>Select Loan Type</option> -->
                                    <option value="home" selected>Loan For Home</option>
                                    <option value="student">Student Loan</option>
                                    <option value="business">Business Loan</option>
                                </select>
                            </div> <br>
                            <div class="mb-3 mt-3">
                                <label for="amount" class="form-label fw-bold">Loan Amount</label>
                                <input type="number" name="amount" class="form-control" id="amount" required>
                            </div>
                        </div>

                        <div class="form-navigation">
                            <button type="button" id="prevButton" disabled class="btn btn-secondary">Previous</button>
                            <button type="button" id="nextButton" class="btn btn-primary">Next</button>
                            <button type="submit" id="submitButton" style="display: none;" class="btn btn-warning text-white">
                                <span id="loan_btn_text">Submit</span>
                                <div class="spinner-border text-light spinner-border-sm d-none" role="status" id="loan_spinner">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </button>
                        </div>
                    </form>
                    
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    const myForm = document.querySelector('#my_loan_form');
    const loanBtnSpinner = document.querySelector('#loan_spinner');
    const loanBtnText = document.querySelector('#loan_btn_text');
    const formSections = document.querySelectorAll('.form-section');
    const prevButton = document.getElementById('prevButton');
    const nextButton = document.getElementById('nextButton');
    const submitButton = document.getElementById('submitButton');
    let currentStep = 1;

    function showStep(step) {
      formSections.forEach(section => {
        section.classList.remove('active');
        if (parseInt(section.dataset.step, 10) === step) {
          section.classList.add('active');
        }
      });

      prevButton.disabled = step === 1;
      nextButton.style.display = step === formSections.length ? 'none' : 'inline-block';
      submitButton.style.display = step === formSections.length ? 'inline-block' : 'none';
    }

    function validateStep(step) {
      const currentSection = document.querySelector(`.form-section[data-step="${step}"]`);
      const inputs = currentSection.querySelectorAll('input');
      for (const input of inputs) {
        if (!input.value.trim()) {
          return false; // If any input is empty, the step is invalid
        }
      }
      return true; // All inputs are filled
    }

    prevButton.addEventListener('click', () => {
      if (currentStep > 1) {
        currentStep--;
        showStep(currentStep);
      }
    });

    nextButton.addEventListener('click', () => {
      if (validateStep(currentStep)) {
        if (currentStep < formSections.length) {
          currentStep++;
          showStep(currentStep);
        }
      } else {
        alert('Please fill in all fields before proceeding.');
      }
    });

    myForm.addEventListener('submit', event => {

        event.preventDefault();

        loanBtnText.style.display = 'none';
        loanBtnSpinner.classList.remove('d-none');
        
        submitButton.disabled = true;
        prevButton.disabled = true;

        myForm.submit();
    });
</script>
{% endblock %}